<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><meta name="generator" content="MATLAB 2023b"><title>01B. Efficient programming</title><style type="text/css">.rtcContent { padding: 30px; } .S0 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 28.8px; min-height: 0px; white-space: pre-wrap; color: rgb(192, 76, 11); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 24px; font-weight: 400; text-align: left;  }
.S1 { margin: 20px 10px 5px 4px; padding: 0px; line-height: 20px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 20px; font-weight: 700; text-align: left;  }
.S2 { margin: 2px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 400; text-align: left;  }
.CodeBlock { background-color: #F5F5F5; margin: 10px 0 10px 0; }
.S3 { border-left: 1px solid rgb(217, 217, 217); border-right: 1px solid rgb(217, 217, 217); border-top: 1px solid rgb(217, 217, 217); border-bottom: 0px none rgb(33, 33, 33); border-radius: 4px 4px 0px 0px; padding: 6px 45px 0px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S4 { border-left: 1px solid rgb(217, 217, 217); border-right: 1px solid rgb(217, 217, 217); border-top: 0px none rgb(33, 33, 33); border-bottom: 0px none rgb(33, 33, 33); border-radius: 0px; padding: 0px 45px 0px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S5 { border-left: 1px solid rgb(217, 217, 217); border-right: 1px solid rgb(217, 217, 217); border-top: 0px none rgb(33, 33, 33); border-bottom: 1px solid rgb(217, 217, 217); border-radius: 0px; padding: 0px 45px 4px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S6 { color: rgb(33, 33, 33); padding: 10px 0px 6px 17px; background: rgb(255, 255, 255) none repeat scroll 0% 0% / auto padding-box border-box; font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px; overflow-x: hidden; line-height: 17.234px;  }
/* Styling that is common to warnings and errors is in diagnosticOutput.css */.embeddedOutputsErrorElement {    min-height: 18px;    max-height: 550px;}
.embeddedOutputsErrorElement .diagnosticMessage-errorType {    overflow: auto;}
.embeddedOutputsErrorElement.inlineElement {}
.embeddedOutputsErrorElement.rightPaneElement {}
/* Styling that is common to warnings and errors is in diagnosticOutput.css */.embeddedOutputsWarningElement {    min-height: 18px;    max-height: 550px;}
.embeddedOutputsWarningElement .diagnosticMessage-warningType {    overflow: auto;}
.embeddedOutputsWarningElement.inlineElement {}
.embeddedOutputsWarningElement.rightPaneElement {}
/* Copyright 2015-2023 The MathWorks, Inc. *//* In this file, styles are not scoped to rtcContainer since they could be in the Dojo Tooltip */.diagnosticMessage-wrapper {    font-family: Menlo, Monaco, Consolas, "Courier New", monospace;    font-size: 12px;}
.diagnosticMessage-wrapper.diagnosticMessage-warningType {    /*This fallback value will be used for appdesigner warnings*/    color: var(--rtc-warning-output-color, var(--mw-color-matlabWarning));}
.diagnosticMessage-wrapper.diagnosticMessage-warningType a {    /*This fallback value will be used for appdesigner warnings*/    color: var(--rtc-warning-output-color, var(--mw-color-matlabWarning));    text-decoration: underline;}
.rtcThemeDefaultOverride .diagnosticMessage-wrapper.diagnosticMessage-warningType,.rtcThemeDefaultOverride .diagnosticMessage-wrapper.diagnosticMessage-warningType a {    color: var(--mw-color-matlabWarning) !important;}
.diagnosticMessage-wrapper.diagnosticMessage-errorType {    /*This fallback value will be used in appdesigner error tooltip text*/    color: var(--rtc-error-output-color, var(--mw-color-matlabErrors));}
.diagnosticMessage-wrapper.diagnosticMessage-errorType a {    /*This fallback value will be used in appdesigner error tooltip text*/    color: var(--rtc-error-output-color, var(--mw-color-matlabErrors));    text-decoration: underline;}
.rtcThemeDefaultOverride .diagnosticMessage-wrapper.diagnosticMessage-errorType,.rtcThemeDefaultOverride .diagnosticMessage-wrapper.diagnosticMessage-errorType a {    color: var(--mw-color-matlabErrors) !important;}
.diagnosticMessage-wrapper .diagnosticMessage-messagePart,.diagnosticMessage-wrapper .diagnosticMessage-causePart {    white-space: pre-wrap;}
.diagnosticMessage-wrapper .diagnosticMessage-stackPart {    white-space: pre;}
.embeddedOutputsTextElement,.embeddedOutputsVariableStringElement {    white-space: pre;    word-wrap:  initial;    min-height: 18px;    max-height: 550px;}
.embeddedOutputsTextElement .textElement,.embeddedOutputsVariableStringElement .textElement {    overflow: auto;}
.textElement,.rtcDataTipElement .textElement {    padding-top: 2px;}
.embeddedOutputsTextElement.inlineElement,.embeddedOutputsVariableStringElement.inlineElement {}
.inlineElement .textElement {}
.embeddedOutputsTextElement.rightPaneElement,.embeddedOutputsVariableStringElement.rightPaneElement {    min-height: 16px;}
.rightPaneElement .textElement {    padding-top: 2px;    padding-left: 9px;}
.S7 { margin: 10px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 400; text-align: left;  }
.S8 { border-left: 1px solid rgb(217, 217, 217); border-right: 1px solid rgb(217, 217, 217); border-top: 1px solid rgb(217, 217, 217); border-bottom: 0px none rgb(33, 33, 33); border-radius: 0px; padding: 6px 45px 0px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S9 { border-left: 1px solid rgb(217, 217, 217); border-right: 1px solid rgb(217, 217, 217); border-top: 1px solid rgb(217, 217, 217); border-bottom: 1px solid rgb(217, 217, 217); border-radius: 0px; padding: 6px 45px 4px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S10 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 18px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 17px; font-weight: 700; text-align: left;  }
.S11 { border-left: 1px solid rgb(217, 217, 217); border-right: 1px solid rgb(217, 217, 217); border-top: 0px none rgb(33, 33, 33); border-bottom: 1px solid rgb(217, 217, 217); border-radius: 0px 0px 4px 4px; padding: 0px 45px 4px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }</style></head><body><div class = rtcContent><h1  class = 'S0'><span>01B. Efficient programming</span></h1><h2  class = 'S1'><span>Mingyang Lu</span></h2><h2  class = 'S1'><span>01/07/2024</span></h2><div  class = 'S2'><span>This code has been adapted from numericalR, originally written for R programming, with adjustments for MATLAB usage. While the following discussions hold true in general, it's important to exercise caution due to the differences between MATLAB and R/Python. Keep in mind that certain optimizations or conventions in one language may not directly translate to the other. Always verify and adapt code accordingly to ensure compatibility and optimal performance in the MATLAB environment.</span></div><h2  class = 'S1'><span>Avoid growing vectors</span></h2><div  class = 'S2'><span>The following code is extremely slow for large n.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: #008013;">% Set the value of n to 10</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >n = 10;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: #008013;">% Create an empty array v</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >v = [];</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: #008013;">% Use a for loop to iterate from 1 to n</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: #0e00ff;">for </span><span >i = 1:n</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >    </span><span style="color: #008013;">% Append the square of i to array v</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >    v = [v, i^2];</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: #0e00ff;">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper outputs"><div  class = 'S5'><span style="white-space: pre"><span >disp(v);</span></span></div><div  class = 'S6'><div class="inlineElement eoOutputWrapper disableDefaultGestureHandling embeddedOutputsTextElement" uid="B62DCD93" prevent-scroll="true" data-testid="output_0" tabindex="-1" style="width: 670px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;"><div class="textElement eoOutputContent" data-previous-available-width="633" data-previous-scroll-height="17" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" tabindex="-1">     1     4     9    16    25    36    49    64    81   100</div></div></div></div></div><div  class = 'S7'><span>A better way creates an array of final length first.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: #008013;">% Set the value of n to 10</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >n = 10;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: #008013;">% Create a numeric array v filled with zeros</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >v = zeros(1, n);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: #008013;">% Use a for loop to iterate from 1 to n</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: #0e00ff;">for </span><span >i = 1:n</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >    </span><span style="color: #008013;">% Assign the square of i to the corresponding element in the array v</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >    v(i) = i^2;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: #0e00ff;">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper outputs"><div  class = 'S5'><span style="white-space: pre"><span >disp(v);</span></span></div><div  class = 'S6'><div class="inlineElement eoOutputWrapper disableDefaultGestureHandling embeddedOutputsTextElement" uid="5DCEBA56" prevent-scroll="true" data-testid="output_1" tabindex="-1" style="width: 670px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;"><div class="textElement eoOutputContent" data-previous-available-width="633" data-previous-scroll-height="17" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" tabindex="-1">     1     4     9    16    25    36    49    64    81   100</div></div></div></div></div><h2  class = 'S1'><span>Vectorize codes</span></h2><div  class = 'S2'><span>An even better approach is the following. It uses vector operations instead.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: #008013;">% Set the value of n to 10</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >n = 10;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: #008013;">% Generate a sequence from 1 to n using MATLAB</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >v = 1:n;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: #008013;">% Square each element in the array v</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >v = v.^2;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper outputs"><div  class = 'S5'><span style="white-space: pre"><span >disp(v);</span></span></div><div  class = 'S6'><div class="inlineElement eoOutputWrapper disableDefaultGestureHandling embeddedOutputsTextElement" uid="D7B098AE" prevent-scroll="true" data-testid="output_2" tabindex="-1" style="width: 670px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;"><div class="textElement eoOutputContent" data-previous-available-width="633" data-previous-scroll-height="17" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" tabindex="-1">     1     4     9    16    25    36    49    64    81   100</div></div></div></div></div><div  class = 'S7'><span>Iteration, e.g., using a For Loop, is typically slow. For example, the following code calculates the mean and standard deviation (SD) of a series of numbers.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: #008013;">% Iterations with a for loop</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >num = 100;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: #008013;">% Initialize variables</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >my_sum = 0;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >my_sum2 = 0;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: #008013;">% Loop through a range from 1 to num</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: #0e00ff;">for </span><span >i = 1:num</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >    my_sum = my_sum + i;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >    my_sum2 = my_sum2 + i^2;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: #0e00ff;">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: #008013;">% Calculate mean and standard deviation</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >my_mean = my_sum / num;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >my_sd = sqrt(my_sum2 / num - my_mean^2);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: #008013;">% Print the mean and standard deviation</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S5'><span style="white-space: pre"><span >fprintf(</span><span style="color: #a709f5;">'%.4f %.4f\n'</span><span >, my_mean, my_sd);</span></span></div><div  class = 'S6'><div class="inlineElement eoOutputWrapper disableDefaultGestureHandling embeddedOutputsTextElement" uid="B2290886" prevent-scroll="true" data-testid="output_3" tabindex="-1" style="width: 670px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;"><div class="textElement eoOutputContent" data-previous-available-width="633" data-previous-scroll-height="17" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" tabindex="-1">50.5000 28.8661</div></div></div></div></div><div  class = 'S7'><span>While the above code is typical for C or Fortran, a better approach for MATLAB is to use vector operations.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: #008013;">% Vectorization</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >num = 100;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: #008013;">% Create a sequence from 1 to num using MATLAB</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >v = 1:num;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: #008013;">% Calculate mean, mean square, and standard deviation</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >my_mean = mean(v);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >my_mean_square = mean(v.^2);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >my_sd = sqrt(my_mean_square - my_mean^2);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: #008013;">% Print the mean and standard deviation</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S5'><span style="white-space: pre"><span >fprintf(</span><span style="color: #a709f5;">'%.4f %.4f\n'</span><span >, my_mean, my_sd);</span></span></div><div  class = 'S6'><div class="inlineElement eoOutputWrapper disableDefaultGestureHandling embeddedOutputsTextElement" uid="77C24242" prevent-scroll="true" data-testid="output_4" tabindex="-1" style="width: 670px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;"><div class="textElement eoOutputContent" data-previous-available-width="633" data-previous-scroll-height="17" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" tabindex="-1">50.5000 28.8661</div></div></div></div></div><div  class = 'S7'><span>Another example to compute standard deviations for each column</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span >rng(</span><span style="color: #a709f5;">'default'</span><span >); </span><span style="color: #008013;">% Set the random number generator to its default settings</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >mat = randn(4); </span><span style="color: #008013;">% Generate a random matrix of size 4x4</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S5'><span style="white-space: pre"><span >disp(mat);</span></span></div><div  class = 'S6'><div class="inlineElement eoOutputWrapper disableDefaultGestureHandling embeddedOutputsTextElement" uid="65D69044" prevent-scroll="true" data-testid="output_5" tabindex="-1" style="width: 670px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;"><div class="textElement eoOutputContent" data-previous-available-width="633" data-previous-scroll-height="61" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" tabindex="-1">    0.5377    0.3188    3.5784    0.7254
    1.8339   -1.3077    2.7694   -0.0631
   -2.2588   -0.4336   -1.3499    0.7147
    0.8622    0.3426    3.0349   -0.2050</div></div></div></div><div class="inlineWrapper"><div  class = 'S8'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: #008013;">% Calculate means, means square, and standard deviations</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >means = mean(mat);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >means2 = mean(mat.^2);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >sd = sqrt(means2 - means.^2);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper outputs"><div  class = 'S5'><span style="white-space: pre"><span >disp(sd);</span></span></div><div  class = 'S6'><div class="inlineElement eoOutputWrapper disableDefaultGestureHandling embeddedOutputsTextElement" uid="5B93558B" prevent-scroll="true" data-testid="output_6" tabindex="-1" style="width: 670px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;"><div class="textElement eoOutputContent" data-previous-available-width="633" data-previous-scroll-height="17" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" tabindex="-1">    1.5215    0.6756    1.9606    0.4300</div></div></div></div></div><div  class = 'S7'><span>Arrayfun can be used to compute standard deviations (similar to apply in R)</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: #008013;">% Calculate standard deviation for each column using arrayfun</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >sd_col = arrayfun(@(col) std(mat(:, col),1), 1:4);</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S5'><span style="white-space: pre"><span >disp(sd_col);</span></span></div><div  class = 'S6'><div class="inlineElement eoOutputWrapper disableDefaultGestureHandling embeddedOutputsTextElement" uid="F400ECD5" prevent-scroll="true" data-testid="output_7" tabindex="-1" style="width: 670px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;"><div class="textElement eoOutputContent" data-previous-available-width="633" data-previous-scroll-height="17" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" tabindex="-1">    1.5215    0.6756    1.9606    0.4300</div></div></div></div><div class="inlineWrapper"><div  class = 'S8'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: #008013;">% Calculate standard deviation for each row using arrayfun</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >sd_row = arrayfun(@(row) std(mat(row, :),1), 1:4);</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S5'><span style="white-space: pre"><span >disp(sd_row);</span></span></div><div  class = 'S6'><div class="inlineElement eoOutputWrapper disableDefaultGestureHandling embeddedOutputsTextElement" uid="7743F039" prevent-scroll="true" data-testid="output_8" tabindex="-1" style="width: 670px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;"><div class="textElement eoOutputContent" data-previous-available-width="633" data-previous-scroll-height="17" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" tabindex="-1">    1.3290    1.5917    1.1017    1.2292</div></div></div></div></div><h2  class = 'S1'><span>Performance evaluation</span></h2><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: #008013;">% Timing the functions</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S5'><span style="white-space: pre"><span >tic;f1(1e7);toc; </span><span style="color: #008013;">% using for loop</span></span></div><div  class = 'S6'><div class="inlineElement eoOutputWrapper disableDefaultGestureHandling embeddedOutputsTextElement" uid="6833ECCC" prevent-scroll="true" data-testid="output_9" tabindex="-1" style="width: 670px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;"><div class="textElement eoOutputContent" data-previous-available-width="633" data-previous-scroll-height="17" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" tabindex="-1">Elapsed time is 0.011023 seconds.</div></div></div></div><div class="inlineWrapper outputs"><div  class = 'S9'><span style="white-space: pre"><span >tic;f2(1e7);toc; </span><span style="color: #008013;">% using vectorization</span></span></div><div  class = 'S6'><div class="inlineElement eoOutputWrapper disableDefaultGestureHandling embeddedOutputsTextElement" uid="D9D2E4E3" prevent-scroll="true" data-testid="output_10" tabindex="-1" style="width: 670px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;"><div class="textElement eoOutputContent" data-previous-available-width="633" data-previous-scroll-height="17" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;" tabindex="-1">Elapsed time is 0.023213 seconds.</div></div></div></div></div><div  class = 'S7'><span>It's suprising that in MATLAB, using for loop is faster. It could be because that MATLAB optimizes loop structures with JIT (Just-In-Time) compiler.</span></div><h3  class = 'S10'><span>Define MATLAB functions</span></h3><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre"><span style="color: #0e00ff;">function </span><span >result = f1(num) </span><span style="color: #008013;">% using for loop</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >    my_sum = 0;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >    my_sum2 = 0;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >    </span><span style="color: #0e00ff;">for </span><span >i = 1:num</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >        my_sum = my_sum + i;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >        my_sum2 = my_sum2 + i^2;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >    </span><span style="color: #0e00ff;">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >    my_mean = my_sum / num;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >    my_sd = sqrt(my_sum2 / num - my_mean^2);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >    result = [my_mean, my_sd];</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: #0e00ff;">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: #0e00ff;">function </span><span >result = f2(num) </span><span style="color: #008013;">% Using vectorization</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >    v = 1:num;</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >    my_mean = mean(v);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >    my_variance = mean(v.^2);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >    my_sd = sqrt(my_variance - my_mean^2);</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span >    result = [my_mean, my_sd];</span></span></div></div><div class="inlineWrapper"><div  class = 'S4'><span style="white-space: pre"><span style="color: #0e00ff;">end</span></span></div></div><div class="inlineWrapper"><div  class = 'S11'>&nbsp;</div></div></div>
<br>
<!-- 
##### SOURCE BEGIN #####
%% 01B. Efficient programming
%% Mingyang Lu
%% 01/07/2024
% This code has been adapted from numericalR, originally written for R programming, 
% with adjustments for MATLAB usage. While the following discussions hold true 
% in general, it's important to exercise caution due to the differences between 
% MATLAB and R/Python. Keep in mind that certain optimizations or conventions 
% in one language may not directly translate to the other. Always verify and adapt 
% code accordingly to ensure compatibility and optimal performance in the MATLAB 
% environment.
%% Avoid growing vectors
% The following code is extremely slow for large n.

% Set the value of n to 10
n = 10;

% Create an empty array v
v = [];

% Use a for loop to iterate from 1 to n
for i = 1:n
    % Append the square of i to array v
    v = [v, i^2];
end

disp(v);
%% 
% A better way creates an array of final length first.

% Set the value of n to 10
n = 10;

% Create a numeric array v filled with zeros
v = zeros(1, n);

% Use a for loop to iterate from 1 to n
for i = 1:n
    % Assign the square of i to the corresponding element in the array v
    v(i) = i^2;
end

disp(v);
%% Vectorize codes
% An even better approach is the following. It uses vector operations instead.

% Set the value of n to 10
n = 10;

% Generate a sequence from 1 to n using MATLAB
v = 1:n;

% Square each element in the array v
v = v.^2;

disp(v);
%% 
% Iteration, e.g., using a For Loop, is typically slow. For example, the following 
% code calculates the mean and standard deviation (SD) of a series of numbers.

% Iterations with a for loop
num = 100;

% Initialize variables
my_sum = 0;
my_sum2 = 0;

% Loop through a range from 1 to num
for i = 1:num
    my_sum = my_sum + i;
    my_sum2 = my_sum2 + i^2;
end

% Calculate mean and standard deviation
my_mean = my_sum / num;
my_sd = sqrt(my_sum2 / num - my_mean^2);

% Print the mean and standard deviation
fprintf('%.4f %.4f\n', my_mean, my_sd);
%% 
% While the above code is typical for C or Fortran, a better approach for MATLAB 
% is to use vector operations.

% Vectorization
num = 100;

% Create a sequence from 1 to num using MATLAB
v = 1:num;

% Calculate mean, mean square, and standard deviation
my_mean = mean(v);
my_mean_square = mean(v.^2);
my_sd = sqrt(my_mean_square - my_mean^2);

% Print the mean and standard deviation
fprintf('%.4f %.4f\n', my_mean, my_sd);
%% 
% Another example to compute standard deviations for each column

rng('default'); % Set the random number generator to its default settings

mat = randn(4); % Generate a random matrix of size 4x4
disp(mat);

% Calculate means, means square, and standard deviations
means = mean(mat);
means2 = mean(mat.^2);
sd = sqrt(means2 - means.^2);

disp(sd);
%% 
% Arrayfun can be used to compute standard deviations (similar to apply in R)

% Calculate standard deviation for each column using arrayfun
sd_col = arrayfun(@(col) std(mat(:, col),1), 1:4);
disp(sd_col);

% Calculate standard deviation for each row using arrayfun
sd_row = arrayfun(@(row) std(mat(row, :),1), 1:4);
disp(sd_row);
%% Performance evaluation

% Timing the functions
tic;f1(1e7);toc; % using for loop
tic;f2(1e7);toc; % using vectorization
%% 
% It's suprising that in MATLAB, using for loop is faster. It could be because 
% that MATLAB optimizes loop structures with JIT (Just-In-Time) compiler.
% Define MATLAB functions

function result = f1(num) % using for loop
    my_sum = 0;
    my_sum2 = 0;

    for i = 1:num
        my_sum = my_sum + i;
        my_sum2 = my_sum2 + i^2;
    end

    my_mean = my_sum / num;
    my_sd = sqrt(my_sum2 / num - my_mean^2);
    result = [my_mean, my_sd];
end

function result = f2(num) % Using vectorization
    v = 1:num;

    my_mean = mean(v);
    my_variance = mean(v.^2);
    my_sd = sqrt(my_variance - my_mean^2);
    result = [my_mean, my_sd];
end
##### SOURCE END #####
-->
</div></body></html>